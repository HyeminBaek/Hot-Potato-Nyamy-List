<!DOCTYPE html>
<html lang="ko">

<head>
    <!-- meta tag : SEO -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>fire_potato nyamnyam list</title>

    <!-- Bootstrap : CDN 서버 통해 file가져오지말고, 직접 라이브러리를 static하게 저장해서 불러오기 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
    <script src="http://code.jquery.com/jquery-latest.min.js"></script>

    <link href="res/css/design.css" rel="stylesheet" type="text/css" />
</head>

<body>
    <div class="event-schedule-area-two bg-color pad100">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="section-title text-center">
                        <div class="title-text text__center">
                            <h2>불감자 먹킷리스트</h2>
                        </div>
                        <p class="text__center">
                            나는 누구인가에 본인 이름 쓰고, 메뉴 쓰면 추가하는 api 필요<br />
                            추가된 날짜 뿐만 아니라 먹은 날짜도 나타낼 수 있음 좋겠음
                        </p>
                    </div>
                    <div class="mt-2 float-right">
                        <button class="btn btn-warning" onClick=foodDelete()>음식 먹었다!</button>
                    </div>
                    <div class="mt-5 mx-auto">
                        <input type="text" placeholder="나는 누구인가?">
                        <input type="text" placeholder="먹고 싶은 메뉴">
                        <button class="btn btn-info mb-3">추가</button>
                    </div>
                </div>
                <!-- /.col end-->
            </div>
            <!-- row end-->
            <div class="row">
                <div class="col-lg-12">
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade active show" id="home" role="tabpanel">
                            <div class="table-responsive">
                                <!-- scroll bar-->
                                <div style="width:100%; height:500px; overflow: auto;">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th class="text-center" scope="col">추가된 날짜</th>
                                                <th scope="col">음식명</th>
                                                <th scope="col">Clear</th>
                                            </tr>
                                        </thead>
                                        <tbody id="target">
                                        </tbody>
                                    </table>
                                </div>
                                <!-- end of scroll bar zone -->
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /col end-->
            </div>
            <!-- /row end-->
        </div>
    </div>
</body>
<script>
    const target = $('#target');
    fetch("http://185.162.75.92:3000/baccine").then(response => {
        return response.json();
    }).then(data => {
        const len = Object.keys(data).length;
        for (let i = 0; i < len; i++) {
            let list = "<tr class=\"inner-box\">";
            list += "<th scope=\"row\">";
            list += "<div class=\"event-date\">";
            list += "<span>";
            list += data[i].created_data.substring(8, 10);
            list += "</span>";

            const month = data[i].created_data.substring(5, 7);
            list += "<p>";
            if (month == 1) list += "January";
            else if (month == 2) list += "Fabruary";
            else if (month == 3) list += "March";
            else if (month == 4) list += "April";
            else if (month == 5) list += "May";
            else if (month == 6) list += "June";
            else if (month == 7) list += "July";
            else if (month == 8) list += "August";
            else if (month == 9) list += "September";
            else if (month == 10) list += "October";
            else if (month == 11) list += "November";
            else if (month == 12) list += "December";
            list += "</p>";

            list += "</div>";
            list += "</th>";
            list += "<td>";
            list += "<div class=\"event-wrap\">";
            list += "<h3>";
            list += data[i].name;
            list += "</h3>";

            list += "<div class=\"meta\">";
            list += "<div class=\"organizers\">";
            list += data[i].created_by;
            list += "</div>";
            list += "</div>";
            list += "</div>";
            list += "</td>";

            list += "<td>";
            list += "<div class=\"r-no\">";
            list += "<span>";

            list += "<label class=\"switch\">";
            list += "<input type=\"checkbox\"";
            if (!data[i].is_clear) list += ">";
            else list += "checked=\"checked\">";

            list += "<span class=\"slider round\"></span>";
            list += "</label>";

            if (!data[i].is_clear) list += "<p>안머금</p>";
            else list += "<p>머금</p>";

            list += "</span>";
            list += "</div>";
            list += "</td>";
            list += "</tr>";

            target.append(list);
        }
    }).catch(err => {
        alert("error!");
    });
</script>
<script>
    function foodDelete() {
        const query = 'input[name="food"]:checked';
        const selectedEls = document.querySelectorAll(query);

        let res = '';
        selectedEls.forEach(selectedEls => {
            //res+=selectedEls.value+" ";

            fetch("http://185.162.75.92:3000/baccine/clear/" + selectedEls.value, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
            }).then(response => {
                //return response.json();
            }).catch(err => {
                alert("error!");
            });
        });
        console.log(res);
        /*
        */
    }
</script>

</html>